import{r as e,C as l,g as a,D as s,c as t,b as o,s as r,E as i,n as u,F as n,d,q as c,o as v,t as p}from"./vendor-BIYNY2sw.js";import{u as f}from"./index-CH-wxIn0.js";const y={id:"player"},w={class:"w-full aspect-video relative flex-shrink-0 flex-1"},b=["src"],m={class:"flex justify-center p-0 flex-shrink-0"},x={class:"bg-black bg-opacity-60 rounded-full p-0 shadow-lg flex items-center w-full max-w-[320px] min-w-[180px] overflow-hidden"},g={key:0,class:"episode-popover absolute bottom-24 left-1/2 -translate-x-1/2 z-140 bg-black bg-opacity-80 rounded-lg shadow-lg p-4 min-w-56 max-h-80 overflow-y-auto transition-opacity scroll-bar"},h=["onClick"],k={key:1,class:"source-popover absolute bottom-24 left-1/2 -translate-x-1/2 z-140 bg-black bg-opacity-80 rounded-lg shadow-lg p-4 min-w-56 max-h-80 overflow-y-auto transition-opacity"},q=["onClick"],_={class:"truncate max-w-[120px]"},I={class:"text-xs px-2 py-1 bg-gray-900 text-gray-300 rounded"},N={key:0,class:"text-xs px-2 py-1 bg-green-900 text-green-300 rounded"},C=((e,l)=>{const a=e.__vccOpts||e;for(const[s,t]of l)a[s]=t;return a})({__name:"Player",setup(C){const O=c(),E=f(),J=e(""),S=e([]),j=e(!0),U=e(0),z=e(null),L=e([]),D=l((()=>J.value?J.value:window.services.parseApi.getParseApi())),F=e(!1),H=e(null),A=e(!1),P=e(!1),R=async()=>{try{document.fullscreenElement?await document.exitFullscreen():await H.value.requestFullscreen()}catch(e){E.error("全屏切换失败")}},B=()=>{F.value=!!document.fullscreenElement},G=async()=>{const e=O.query.keyword||O.query.title,l=await window.services.video.search(e);L.value=l.list||[]},K=e=>{e.target.closest(".episode-popover")||e.target.closest(".source-popover")||e.target.closest(".episode-btn")||e.target.closest(".source-btn")||(A.value=!1,P.value=!1)};return a((async()=>{await(async()=>{try{const e=O.params.id;if("history"===O.query.from)return U.value=Number(O.query.episodeIndex)||0,J.value=O.query.episodeUrl||"",z.value={vod_id:O.query.vod_id,vod_name:O.query.title,sourceId:O.query.sourceId,sourceName:O.query.sourceName,platform:O.query.platform||"",episodeIndex:U.value,episodeUrl:J.value,keyword:O.query.keyword,episodes:O.query.episodes?JSON.parse(O.query.episodes):[]},z.value.episodes&&z.value.episodes.length>0?S.value=z.value.episodes:await G(),void(j.value=!1);const l=await window.services.video.getDetail(e,O.query.sourceId);S.value=l.episodes||[],U.value=0,J.value=S.value[0]||"",z.value={vod_id:e,vod_name:O.query.title,sourceId:O.query.sourceId,sourceName:O.query.sourceName,platform:l.platform||"",episodeIndex:0,episodeUrl:J.value,keyword:O.query.keyword,episodes:[]},await G();const a={...z.value,episodes:JSON.parse(JSON.stringify(S.value))};window.services.history.addHistory(a)}catch(e){E.error("获取视频信息失败")}finally{j.value=!1}})(),document.addEventListener("click",K),document.addEventListener("fullscreenchange",B)})),s((()=>{document.removeEventListener("click",K),document.removeEventListener("fullscreenchange",B)})),(e,l)=>(v(),t("div",y,[o("div",{ref_key:"wrapperRef",ref:H,class:u(["player-fullscreen-wrapper flex flex-col w-full max-w-5xl mx-auto rounded-lg bg-black opacity-90 shadow-lg overflow-hidden",F.value?"fixed inset-0 z-100 w-screen h-screen max-w-none":""])},[o("div",w,[o("iframe",{src:D.value,class:"w-full h-full absolute left-0 top-0 z-0",frameborder:"0",allowfullscreen:""},null,8,b)]),o("div",m,[o("div",x,[o("button",{class:"episode-btn flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0","aria-label":"选集",onClick:l[0]||(l[0]=i((e=>{A.value=!A.value,P.value=!1}),["stop"]))},l[2]||(l[2]=[o("i",{class:"i-ri-list-unordered text-2xl"},null,-1)])),o("button",{class:"source-btn flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0 border-l border-white/10","aria-label":"换源",onClick:l[1]||(l[1]=i((e=>{P.value=!P.value,A.value=!1}),["stop"]))},l[3]||(l[3]=[o("i",{class:"i-ri-global-line text-2xl"},null,-1)])),o("button",{onClick:R,class:"flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0 border-l border-white/10","aria-label":"全屏"},[o("i",{class:u([F.value?"i-ri-fullscreen-exit-line":"i-ri-fullscreen-line","text-2xl"])},null,2)])])]),A.value?(v(),t("div",g,[l[4]||(l[4]=o("div",{class:"text-white font-bold mb-2"},"选集",-1)),(v(!0),t(n,null,d(S.value,((e,l)=>(v(),t("button",{key:l,onClick:e=>{(e=>{U.value=e,J.value=S.value[e],z.value.episodeIndex=e,z.value.episodeUrl=J.value;const l={...z.value,episodes:JSON.parse(JSON.stringify(S.value))};window.services.history.addHistory(l)})(l),A.value=!1},class:u(["w-full text-left px-4 py-2 rounded mb-1 bg-transparent",l===U.value?"bg-blue-600 text-white font-bold":"hover:bg-blue-700 text-white"])}," 第"+p(l+1)+"集 ",11,h)))),128))])):r("",!0),P.value?(v(),t("div",k,[l[5]||(l[5]=o("div",{class:"text-white font-bold mb-2"},"换源",-1)),(v(!0),t(n,null,d(L.value,(e=>{var l,a;return v(),t("div",{key:e.vod_id+"-"+e.sourceId,onClick:l=>{(async e=>{j.value=!0;try{const l=await window.services.video.getDetail(e.vod_id,e.sourceId);S.value=l.episodes||[];const a=U.value;let s=0;S.value.length>a?s=a:(E.info("新源集数与原源不一致，已为您切换到第1集，请手动选择"),s=0),U.value=s,J.value=S.value[s]||"",z.value={vod_id:e.vod_id,vod_name:e.vod_name,sourceId:e.sourceId,sourceName:e.sourceName,platform:l.platform||"",episodeIndex:s,episodeUrl:J.value,keyword:O.query.keyword,episodes:[]};const t={...z.value,episodes:JSON.parse(JSON.stringify(S.value))};window.services.history.addHistory(t)}catch(l){E.error("切换源失败")}finally{j.value=!1}})(e),P.value=!1},class:u(["w-full text-left px-4 py-2 rounded mb-1 flex items-center gap-2",e.vod_id===(null==(l=z.value)?void 0:l.vod_id)&&e.sourceId===(null==(a=z.value)?void 0:a.sourceId)?"bg-blue-600 text-white font-bold":"hover:bg-blue-700 text-white"])},[o("span",_,p(e.vod_name),1),o("span",I,p(e.sourceName),1),e.platform?(v(),t("span",N,p(e.platform),1)):r("",!0)],10,q)})),128))])):r("",!0)],2)]))}},[["__scopeId","data-v-6040a7bc"]]);export{C as default};
