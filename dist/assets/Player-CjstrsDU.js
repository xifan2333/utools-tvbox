import{r as e,C as l,g as a,D as t,c as r,b as o,s,E as u,n as i,F as n,d,q as c,o as v,t as p}from"./vendor-BIYNY2sw.js";import{u as f}from"./index-CkzwiveK.js";const m={id:"player"},y={class:"w-full aspect-video relative flex-shrink-0 flex-1"},w=["src"],b={class:"flex justify-center p-0 flex-shrink-0"},x={class:"bg-black bg-opacity-60 rounded-full p-0 shadow-lg flex items-center w-full max-w-[320px] min-w-[180px] overflow-hidden"},g={key:0,class:"episode-popover absolute bottom-24 left-1/2 -translate-x-1/2 z-140 bg-black bg-opacity-80 rounded-lg shadow-lg p-4 min-w-56 max-h-80 overflow-y-auto transition-opacity scroll-bar"},h=["onClick"],k={key:1,class:"source-popover absolute bottom-24 left-1/2 -translate-x-1/2 z-140 bg-black bg-opacity-80 rounded-lg shadow-lg p-4 min-w-56 max-h-80 overflow-y-auto transition-opacity"},_=["onClick"],q={class:"truncate max-w-[120px]"},I={class:"text-xs px-2 py-1 bg-gray-900 text-gray-300 rounded"},N={key:0,class:"text-xs px-2 py-1 bg-green-900 text-green-300 rounded"},C=((e,l)=>{const a=e.__vccOpts||e;for(const[t,r]of l)a[t]=r;return a})({__name:"Player",setup(C){const E=c(),j=f(),U=e(""),z=e([]),L=e(!0),T=e(0),D=e(null),F=e([]),H=l((()=>U.value?U.value:window.services.parseApi.getParseApi())),A=e(0),P=e(!1),O=e(null),R=e(!1),B=e(!1),G=async()=>{try{document.fullscreenElement?await document.exitFullscreen():await O.value.requestFullscreen()}catch(e){j.error("全屏切换失败")}},J=()=>{P.value=!!document.fullscreenElement},K=async()=>{const e=E.query.keyword||E.query.title,l=await window.services.video.search(e);F.value=l.list||[]},M=e=>{e.target.closest(".episode-popover")||e.target.closest(".source-popover")||e.target.closest(".episode-btn")||e.target.closest(".source-btn")||(R.value=!1,B.value=!1)};return a((async()=>{await(async()=>{try{const e=E.params.id;if("history"===E.query.from)return T.value=Number(E.query.episodeIndex)||0,U.value=E.query.episodeUrl||"",A.value=Number(E.query.lastTime)||0,D.value={vod_id:E.query.vod_id,vod_name:E.query.title,sourceId:E.query.sourceId,sourceName:E.query.sourceName,platform:E.query.platform||"",episodeIndex:T.value,episodeUrl:U.value,keyword:E.query.keyword},await K(),void(L.value=!1);const l=await window.services.video.getDetail(e,E.query.sourceId);z.value=l.episodes||[],T.value=0,U.value=z.value[0]||"",D.value={vod_id:e,vod_name:E.query.title,sourceId:E.query.sourceId,sourceName:E.query.sourceName,platform:l.platform||"",episodeIndex:0,episodeUrl:U.value,keyword:E.query.keyword},await K(),window.services.history.addHistory({...D.value,lastTime:A.value})}catch(e){j.error("获取视频信息失败")}finally{L.value=!1}})(),document.addEventListener("click",M),document.addEventListener("fullscreenchange",J)})),t((()=>{document.removeEventListener("click",M),document.removeEventListener("fullscreenchange",J)})),(e,l)=>(v(),r("div",m,[o("div",{ref_key:"wrapperRef",ref:O,class:i(["player-fullscreen-wrapper flex flex-col w-full max-w-5xl mx-auto rounded-lg bg-black opacity-90 shadow-lg overflow-hidden",P.value?"fixed inset-0 z-100 w-screen h-screen max-w-none":""])},[o("div",y,[o("iframe",{src:H.value,class:"w-full h-full absolute left-0 top-0 z-0",frameborder:"0",allowfullscreen:""},null,8,w)]),o("div",b,[o("div",x,[o("button",{class:"episode-btn flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0","aria-label":"选集",onClick:l[0]||(l[0]=u((e=>{R.value=!R.value,B.value=!1}),["stop"]))},l[2]||(l[2]=[o("i",{class:"i-ri-list-unordered text-2xl"},null,-1)])),o("button",{class:"source-btn flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0 border-l border-white/10","aria-label":"换源",onClick:l[1]||(l[1]=u((e=>{B.value=!B.value,R.value=!1}),["stop"]))},l[3]||(l[3]=[o("i",{class:"i-ri-global-line text-2xl"},null,-1)])),o("button",{onClick:G,class:"flex-1 h-12 rounded-none flex items-center justify-center text-white hover:bg-black/80 transition bg-transparent min-w-0 border-l border-white/10","aria-label":"全屏"},[o("i",{class:i([P.value?"i-ri-fullscreen-exit-line":"i-ri-fullscreen-line","text-2xl"])},null,2)])])]),R.value?(v(),r("div",g,[l[4]||(l[4]=o("div",{class:"text-white font-bold mb-2"},"选集",-1)),(v(!0),r(n,null,d(z.value,((e,l)=>(v(),r("button",{key:l,onClick:e=>{(e=>{T.value=e,U.value=z.value[e],D.value.episodeIndex=e,D.value.episodeUrl=U.value,window.services.history.addHistory({...D.value,lastTime:A.value})})(l),R.value=!1},class:i(["w-full text-left px-4 py-2 rounded mb-1 bg-transparent",l===T.value?"bg-blue-600 text-white font-bold":"hover:bg-blue-700 text-white"])}," 第"+p(l+1)+"集 ",11,h)))),128))])):s("",!0),B.value?(v(),r("div",k,[l[5]||(l[5]=o("div",{class:"text-white font-bold mb-2"},"换源",-1)),(v(!0),r(n,null,d(F.value,(e=>{var l,a;return v(),r("div",{key:e.vod_id+"-"+e.sourceId,onClick:l=>{(async e=>{L.value=!0;try{const l=await window.services.video.getDetail(e.vod_id,e.sourceId);z.value=l.episodes||[];const a=T.value;let t=0;z.value.length>a?t=a:(j.info("新源集数与原源不一致，已为您切换到第1集，请手动选择"),t=0),T.value=t,U.value=z.value[t]||"",D.value={vod_id:e.vod_id,vod_name:e.vod_name,sourceId:e.sourceId,sourceName:e.sourceName,platform:l.platform||"",episodeIndex:t,episodeUrl:U.value,keyword:E.query.keyword},window.services.history.addHistory({...D.value,lastTime:0})}catch(l){j.error("切换源失败")}finally{L.value=!1}})(e),B.value=!1},class:i(["w-full text-left px-4 py-2 rounded mb-1 flex items-center gap-2",e.vod_id===(null==(l=D.value)?void 0:l.vod_id)&&e.sourceId===(null==(a=D.value)?void 0:a.sourceId)?"bg-blue-600 text-white font-bold":"hover:bg-blue-700 text-white"])},[o("span",q,p(e.vod_name),1),o("span",I,p(e.sourceName),1),e.platform?(v(),r("span",N,p(e.platform),1)):s("",!0)],10,_)})),128))])):s("",!0)],2)]))}},[["__scopeId","data-v-39a32585"]]);export{C as default};
