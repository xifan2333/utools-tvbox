{"version":3,"file":"History-Cppn6sJ2.js","sources":["../../src/views/History.vue"],"sourcesContent":["<template>\n  <div class=\"p-8\">\n    <div class=\"flex justify-between items-center mb-6\">\n      <h1 class=\"text-2xl font-bold text-gray-800 dark:text-gray-200\">观看历史</h1>\n      <button\n        v-if=\"histories.length > 0\"\n        class=\"px-4 py-2 text-sm bg-red-500 text-white rounded-md transition-colors hover:bg-red-600\"\n        @click=\"clearHistories\"\n      >\n        <i class=\"i-ri-delete-bin-3-line\"></i>\n        清空历史\n      </button>\n    </div>\n\n    <div v-if=\"histories.length === 0\" class=\"text-center text-gray-400 text-xl py-12\">\n      暂无观看历史\n    </div>\n\n    <div v-else class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n      <div\n        v-for=\"history in histories\"\n        :key=\"history.id\"\n        class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden group\"\n      >\n        <!-- 视频信息卡片 -->\n        <div class=\"p-4\">\n          <h3 class=\"text-lg font-medium text-gray-800 dark:text-gray-200 mb-2 line-clamp-2\">\n            {{ history.vod_name }}\n          </h3>\n          <p v-if=\"history.vod_remarks\" class=\"text-sm text-gray-500 dark:text-gray-400 mb-3\">\n            {{ history.vod_remarks }}\n          </p>\n          \n          <!-- 进度条 -->\n          <div class=\"h-1 bg-gray-200 dark:bg-gray-700 rounded-full mb-3\">\n            <div\n              class=\"h-full bg-blue-500 rounded-full\"\n              :style=\"{ width: `${((history.currentEpisodeIndex + 1) / history.episodes.length) * 100}%` }\"\n            ></div>\n          </div>\n\n          <!-- 底部信息 -->\n          <div class=\"flex justify-between items-center text-sm text-gray-500 dark:text-gray-400\">\n            <div class=\"flex items-center space-x-2\">\n              <span>{{ formatTime(history.currentTime) }}</span>\n              <span class=\"text-gray-400\">|</span>\n              <span>第 {{ history.currentEpisodeIndex + 1 }}/{{ history.episodes.length }} 集</span>\n            </div>\n            <div class=\"flex gap-2\">\n              <button\n                class=\"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\"\n                @click=\"continueWatching(history)\"\n              >\n                <i class=\"i-ri-play-circle-line\"></i>\n                继续观看\n              </button>\n              <button\n                class=\"px-3 py-1 text-white hover:bg-red-600 transition-colors bg-red-500 rounded-md\"\n                @click=\"removeHistory(history.vod_id)\"\n              >\n                <i class=\"i-ri-delete-bin-2-line\"></i>\n                删除\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nconst histories = ref([])\n\n// 获取历史记录\nconst loadHistories = () => {\n  histories.value = window.services.history.getHistories()\n}\n\n// 继续观看\nconst continueWatching = (history) => {\n  if (!history.episodes || history.episodes.length === 0) {\n    console.error('无效的分集信息')\n    return\n  }\n  \n  router.push({\n    path: `/player/${history.vod_id}`,\n    query: {\n      title: history.vod_name,\n      vod_id: history.vod_id,\n      vod_remarks: history.vod_remarks,\n      vod_play_from: history.vod_play_from,\n      type_id: history.type_id,\n      type_name: history.type_name,\n      episodes: JSON.stringify(history.episodes),\n      currentEpisodeIndex: history.currentEpisodeIndex || 0,\n      time: history.currentTime || 0\n    }\n  })\n}\n\n// 删除历史记录\nconst removeHistory = (id) => {\n  window.services.history.removeHistory(id)\n  loadHistories()\n}\n\n// 清空历史记录\nconst clearHistories = () => {\n  if (confirm('确定要清空所有观看历史吗？')) {\n    window.services.history.clearHistories()\n    loadHistories()\n  }\n}\n\n// 格式化时间\nconst formatTime = (seconds) => {\n  if (!seconds) return '00:00'\n  const minutes = Math.floor(seconds / 60)\n  const remainingSeconds = Math.floor(seconds % 60)\n  return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`\n}\n\nonMounted(() => {\n  loadHistories()\n})\n</script> "],"names":["router","useRouter","histories","ref","loadHistories","continueWatching","history","removeHistory","id","clearHistories","formatTime","seconds","minutes","remainingSeconds","onMounted"],"mappings":"+vBA2EA,MAAMA,EAASC,EAAS,EAClBC,EAAYC,EAAI,CAAE,CAAA,EAGlBC,EAAgB,IAAM,CAC1BF,EAAU,MAAQ,OAAO,SAAS,QAAQ,aAAY,CACxD,EAGMG,EAAoBC,GAAY,CACpC,GAAI,CAACA,EAAQ,UAAYA,EAAQ,SAAS,SAAW,EAAG,CACtD,QAAQ,MAAM,SAAS,EACvB,MACJ,CAEEN,EAAO,KAAK,CACV,KAAM,WAAWM,EAAQ,MAAM,GAC/B,MAAO,CACL,MAAOA,EAAQ,SACf,OAAQA,EAAQ,OAChB,YAAaA,EAAQ,YACrB,cAAeA,EAAQ,cACvB,QAASA,EAAQ,QACjB,UAAWA,EAAQ,UACnB,SAAU,KAAK,UAAUA,EAAQ,QAAQ,EACzC,oBAAqBA,EAAQ,qBAAuB,EACpD,KAAMA,EAAQ,aAAe,CACnC,CACG,CAAA,CACH,EAGMC,EAAiBC,GAAO,CAC5B,OAAO,SAAS,QAAQ,cAAcA,CAAE,EACxCJ,EAAa,CACf,EAGMK,EAAiB,IAAM,CACvB,QAAQ,eAAe,IACzB,OAAO,SAAS,QAAQ,eAAc,EACtCL,EAAa,EAEjB,EAGMM,EAAcC,GAAY,CAC9B,GAAI,CAACA,EAAS,MAAO,QACrB,MAAMC,EAAU,KAAK,MAAMD,EAAU,EAAE,EACjCE,EAAmB,KAAK,MAAMF,EAAU,EAAE,EAChD,MAAO,GAAGC,EAAQ,SAAU,EAAC,SAAS,EAAG,GAAG,CAAC,IAAIC,EAAiB,SAAU,EAAC,SAAS,EAAG,GAAG,CAAC,EAC/F,EAEA,OAAAC,EAAU,IAAM,CACdV,EAAa,CACf,CAAC"}